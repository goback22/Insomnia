<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace속성:매퍼파일의 완전한경로 .xml는 생략 -->
<!-- ※ibatis와는 다르게 id값에 .(dot)를 사용 못한다. -->

<mapper namespace="mapper.sgh">

	<!-- 소셜 로그인 -->
	<select id="isSocialMember" parameterType="java.util.Map" resultType="int">
		select count(*) from members where id=#{socialId}
	</select>
	
	<!-- 소셜 회원가입 -->
	<insert id="socialRegister" parameterType="java.util.Map">
		insert into members(id, email, name, gender, profile_img, birthday, join_date, login_chain, phone) 
		values(#{socialId}, #{socialEmail}, #{socialName}, #{socialGender}, #{socialProfile}, #{socialBirth}, sysdate, #{socialSite}, 010)
	</insert>
	
	<!-- 소셜 추가정보 입력 -->
	<update id="update_social" parameterType="java.util.Map">
		update members set email=#{email}, zip_code=#{zip_code}, shipping_address=#{address}, phone=#{phone}, birthday=#{birthday}
	
	</update>
	
	<!-- 회원 1인의 정보 갖고오기 -->
	<select id="selectOne_Member" parameterType="java.util.Map" resultType="MemberDTO">
		select * from members where id=#{id}
	</select>
	
	<!-- 회원의 프로필 사진을 등록/수정 -->
	<update id="update_Profile" parameterType="java.util.Map">
		update members set profile_img = #{profile_img} where id = #{id}
	</update>
	
	<!-- ======================================================================================================= -->
	
	<!-- 전체 리워드의 수 구하기 : 추후 사용? -->
	<select id="getTotalCount_reward" parameterType="java.util.Map" resultType="int">
		select count(*) from reward
	</select>
	
	<!-- 마이페이지에서 펀딩한 리워드 목록 가져오기 -->  <!-- 수정해야 -->
	<select id="selectList_reward" parameterType="java.util.Map" resultType="RewardDTO">
		select * from (select t.*, rownum r from (select r_no, r_price, r_name, s_no, r_description, b_name, bm_name, sw_image_1 from (select r.*, bm_name, b_name, sw_image_1 from reward r join safepay s on r.r_no = s.r_no
		
		join bandsubmit bs on bs.s_no = r.s_no
		join bandsubmitwaiting bsw on bsw.sw_no = bs.sw_no
		join band b on b.b_no = bs.b_no
		join bandmusic bm on bm.b_no = b.b_no
		
        where id = #{id}
        )) t) where r between #{start} and #{end}
	</select>
	
	<!-- 마이페이지 리워드, 페이징 위한 갯수 구하기 -->  <!-- 수정해야 -->
	<select id="getCount_reward" parameterType="java.util.Map" resultType="int">
	  select count(*) from (select r.*, bm_name , b_name from reward r join safepay s on r.r_no = s.r_no
		join bandsubmit bs on bs.s_no = r.s_no
		join band b on b.b_no = bs.b_no
		join bandmusic bm on bm.b_no = b.b_no
        where id = #{id})
	</select>
	
	
	<!-- 마이페이지에서 방구석 기타리스트 목록 가져오기 -->
	<select id="selectMyList_bgsconcert" parameterType="java.util.Map" resultType="BGSConcertDTO">
		select * from (select t.*, rownum r from (select c.*, c_concertDate, c_price, qty from bgsconcert c join concerttimes t on c.bgsco_no = t.bgsco_no
		join bgspay p on p.ct_no = t.ct_no
		where id = #{id}
		) t) where r between #{start} and #{end}
	</select>
	
	<!-- 마이페이지 방구석 페이징 위한 갯수 구하기  -->
	<select id="getCount_bgsconcert" parameterType="java.util.Map" resultType="int">
		select count(*) from (select t.* from (select c.*, c_concertDate, c_price, qty from bgsconcert c join concerttimes t on c.bgsco_no = t.bgsco_no
		join bgspay p on p.ct_no = t.ct_no
		where id = #{id}) t)
	</select>
	
</mapper>
